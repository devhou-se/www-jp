<!DOCTYPE html>
<html>
{{- partial "head.html" . -}}
<body>
<div class="コンテナ">
    <div class="ヘッダ 章">
        {{- partial "header.html" . -}}
    </div>
    <div class="主要">
        <div class="左-ナビ 章">
            {{- partial "sidebar.html" . }}
        </div>
        <div class="内容 章">
            {{- block "main" . }}{{- end }}
        </div>
        <div class="右-ナビ 章">
            {{- partial "infobar.html" . }}
        </div>
    </div>
</div>
{{ partial "footer.html" . }}
<script>
    // Theme functionality
    function applyTheme(theme) {
        const darkStylesheet = document.getElementById('theme-dark');
        const lightStylesheet = document.getElementById('theme-light');
        if (darkStylesheet && lightStylesheet) {
            darkStylesheet.disabled = (theme !== 'dark');
            lightStylesheet.disabled = (theme === 'dark');
        }
        updateLogo(theme);
    }

    function updateLogo(theme) {
        const logo = document.getElementById('site-logo');
        if (logo) {
            logo.src = theme === 'light' ? '/images/logo-dark.svg' : '/images/logo-white.svg';
        }
    }

    function getPreferredTheme() {
        return window.getPreferredTheme();
    }

    function toggleTheme() {
        const currentTheme = getPreferredTheme();
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        localStorage.setItem('theme', newTheme);
        applyTheme(newTheme);
    }


    // Mobile collapsible sidebar and theme initialization
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize theme and logo
        const theme = getPreferredTheme();
        applyTheme(theme);

        // Theme toggle button
        const themeToggle = document.getElementById('theme-toggle');
        if (themeToggle) {
            themeToggle.addEventListener('click', function(e) {
                e.preventDefault();
                toggleTheme();
            });
        }

        // Mobile sidebar behavior
        if (window.innerWidth <= 1400) {
            const sidebar = document.querySelector('div.左-ナビ');
            if (sidebar) {
                // Start collapsed on mobile
                sidebar.classList.add('collapsed');

                const heading = sidebar.querySelector('p');
                if (heading) {
                    heading.addEventListener('click', function() {
                        sidebar.classList.toggle('collapsed');
                    });
                }
            }
        }

        // Re-check on window resize
        window.addEventListener('resize', function() {
            const sidebar = document.querySelector('div.左-ナビ');
            if (sidebar) {
                if (window.innerWidth <= 1400) {
                    if (!sidebar.classList.contains('collapsed')) {
                        sidebar.classList.add('collapsed');
                    }
                } else {
                    sidebar.classList.remove('collapsed');
                }
            }
        });
    });
</script>
</body>
</html>